<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>olfactory connectivity • hemibrainr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="olfactory connectivity">
<meta property="og:description" content="hemibrainr">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hemibrainr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/data.html">hemibrain and flywire meta data</a>
    </li>
    <li>
      <a href="../articles/flywire.html">flywire</a>
    </li>
    <li>
      <a href="../articles/google_filestream.html">read data from Google drive</a>
    </li>
    <li>
      <a href="../articles/hemibrain_alpns_toons.html">olfactory connectivity</a>
    </li>
    <li>
      <a href="../articles/hemibrain_axons_dendrites.html">axons and dendrites</a>
    </li>
    <li>
      <a href="../articles/hemibrain_connectivity.html">hemibrain connectivity</a>
    </li>
    <li>
      <a href="../articles/match_making.html">neuron match making</a>
    </li>
    <li>
      <a href="../articles/packages_guide.html">related packages</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/flyconnectome/hemibrainr/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>olfactory connectivity</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/flyconnectome/hemibrainr/blob/master/vignettes/hemibrain_alpns_toons.Rmd"><code>vignettes/hemibrain_alpns_toons.Rmd</code></a></small>
      <div class="hidden name"><code>hemibrain_alpns_toons.Rmd</code></div>

    </div>

    
    
<div id="connection-data" class="section level1">
<h1 class="hasAnchor">
<a href="#connection-data" class="anchor"></a>Connection data</h1>
<p>In this guide, we will use examine the connectivity between antennal lobe projection neurons (ALPNs), the principal chemosensory second-order neurons of the fly brain, and their third order targets (TONs). We want to see whether certain groups of ALPNs preferentially connect with certain groups of TONs.</p>
<div id="load-google-drive" class="section level2">
<h2 class="hasAnchor">
<a href="#load-google-drive" class="anchor"></a>Load google drive</h2>
<p>Let’s get hemibrainr and our Google drive loaded:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load package</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/flyconnectome/hemibrainr">hemibrainr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">gplots</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://had.co.nz/plyr">plyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/reshape">reshape2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">ComplexHeatmap</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">LaCroixColoR</span><span class="op">)</span>

<span class="co"># Else, it wants to see it on the mounted team drive, here</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span><span class="st">"Gdrive_hemibrain_data"</span><span class="op">)</span>

<span class="co"># If this does not give a path to the hemibrainr google drive...</span>
<span class="co">## But you do have access, and have set up rclone</span>
<span class="co">### Try:</span>
<span class="co">##### hemibrainr_rclone()</span></code></pre></div>
</div>
<div id="find-neurons-of-interest" class="section level2">
<h2 class="hasAnchor">
<a href="#find-neurons-of-interest" class="anchor"></a>Find neurons of interest</h2>
<p>First, let us find these neurons, so we can plot them if we like:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">db</span> <span class="op">=</span> <span class="fu"><a href="../reference/hemibrain_read_neurons.html">hemibrain_neurons</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">alpns.nl</span><span class="op">=</span> <span class="va">db</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">db</span><span class="op">)</span><span class="op">%in%</span><span class="fu">hemibrainr</span><span class="fu">::</span><span class="va"><a href="../reference/info.html">pn.info</a></span><span class="op">$</span><span class="va">bodyid</span><span class="op">]</span>
<span class="va">ton.nl</span> <span class="op">=</span> <span class="va">db</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">db</span><span class="op">)</span><span class="op">%in%</span><span class="fu">hemibrainr</span><span class="fu">::</span><span class="va"><a href="../reference/info.html">ton.info</a></span><span class="op">$</span><span class="va">bodyid</span><span class="op">]</span></code></pre></div>
<p>We can now plot them if we like:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get ROIs</span>
<span class="va">lhr</span> <span class="op">=</span> <span class="fu">neuprint_ROI_mesh</span><span class="op">(</span><span class="st">"LH(R)"</span><span class="op">)</span>
<span class="va">alr</span> <span class="op">=</span> <span class="fu">neuprint_ROI_mesh</span><span class="op">(</span><span class="st">"AL(R)"</span><span class="op">)</span>

<span class="co"># Plot</span>
<span class="fu">nat</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nat/man/nopen3d.html">nopen3d</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="../reference/hemibrain_view.html">hemibrain_view</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/nat/man/plot3d.html">plot3d</a></span><span class="op">(</span><span class="va">lhr</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, col <span class="op">=</span> <span class="va">hemibrain_bright_colors</span><span class="op">[</span><span class="st">"green"</span><span class="op">]</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/nat/man/plot3d.html">plot3d</a></span><span class="op">(</span><span class="va">alr</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, col <span class="op">=</span> <span class="va">hemibrain_bright_colors</span><span class="op">[</span><span class="st">"red"</span><span class="op">]</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/nat/man/plot3d.html">plot3d</a></span><span class="op">(</span><span class="va">hemibrain.surf</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>, col <span class="op">=</span> <span class="st">"lightgrey"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="../reference/plot3d_split.html">plot3d_split</a></span><span class="op">(</span><span class="va">alpns.nl</span>, lwd <span class="op">=</span><span class="fl">2</span>, soma <span class="op">=</span> <span class="fl">600</span>, col <span class="op">=</span> <span class="va">hemibrain_bright_colours</span><span class="op">[</span><span class="st">"cerise"</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="../reference/plot3d_split.html">plot3d_split</a></span><span class="op">(</span><span class="va">ton.nl</span>, lwd <span class="op">=</span><span class="fl">2</span>, soma <span class="op">=</span> <span class="fl">600</span>, col <span class="op">=</span> <span class="fu"><a href="../reference/hemibrain_colours.html">hemibrain_bright_colour_ramp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">ton.nl</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="get-neuron-connectivity-data" class="section level2">
<h2 class="hasAnchor">
<a href="#get-neuron-connectivity-data" class="anchor"></a>Get neuron connectivity data</h2>
<p>Now we can get a precomputed edgelist for the brain from the Google drive, which breaks down connections by axon and dendrite. By default this is read from an SQLite database on the Google drive. This means we can access the data, without loading a multi Gb .csv into memory:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get  the edgelist</span>
<span class="va">elist</span> <span class="op">=</span> <span class="fu"><a href="../reference/hemibrainr_googledrive_data.html">hemibrain_elist</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">meta</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/plyr/man/rbind.fill.html">rbind.fill</a></span><span class="op">(</span><span class="va">ton.info</span>, <span class="va">pn.info</span><span class="op">)</span></code></pre></div>
<p>In our <code>elist</code>, count is the number of synaptic connections between two arbours. The arbour types are given by <code>Label</code> and <code>partner.Label</code>. The neuron identities are given as <code>pre</code>, the upstream (source) neuron and <code>post</code>, the downstream (target) neuron. The value of <code>norm</code> is generated by taking <code>count</code> and dividing it by the total number of postsynapses on the downstream target’s given arbour (note, not all connection in the neuron!). See your <a href="https://natverse.github.io/hemibrainr/articles/hemibrain_axons_dendrites.html">article</a> on neuron splitting, for more information.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">alpn.lhn.elist</span> <span class="op">&lt;-</span> <span class="va">elist</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">pre</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/eval.html">local</a></span><span class="op">(</span><span class="va">pn.info</span><span class="op">$</span><span class="va">bodyid</span><span class="op">)</span> 
                <span class="op">&amp;</span> <span class="va">post</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/eval.html">local</a></span><span class="op">(</span><span class="va">ton.info</span><span class="op">$</span><span class="va">bodyid</span><span class="op">)</span>
                <span class="op">&amp;</span> <span class="va">pre.Label</span> <span class="op">==</span> <span class="st">"axon"</span>
                <span class="op">&amp;</span> <span class="va">post.Label</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dendrite"</span>,<span class="st">"axon"</span><span class="op">)</span>
                <span class="op">&amp;</span> <span class="op">(</span><span class="va">count</span> <span class="op">&gt;</span> <span class="fl">10</span> <span class="op">|</span> <span class="va">norm</span> <span class="op">&gt;</span> <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># this is now a data frame. This may take a while to load into R.</span>

<span class="co"># Add some cell type information</span>
<span class="va">alpn.lhn.elist</span> <span class="op">&lt;-</span> <span class="va">alpn.lhn.elist</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>pre.cell.type <span class="op">=</span> <span class="va">meta</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">pre</span>,<span class="va">meta</span><span class="op">$</span><span class="va">bodyid</span><span class="op">)</span>,<span class="st">"cell.type"</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>post.cell.type <span class="op">=</span> <span class="va">meta</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">post</span>,<span class="va">meta</span><span class="op">$</span><span class="va">bodyid</span><span class="op">)</span>,<span class="st">"cell.type"</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span>stringsAsFactors<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># Convert edgelist to a connectivity matrix</span>
<span class="va">conn.mat</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/cast.html">acast</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">alpn.lhn.elist</span>, 
                 formula <span class="op">=</span> <span class="va">pre.cell.type</span> <span class="op">~</span> <span class="va">post.cell.type</span> <span class="op">+</span> <span class="va">post.Label</span>, 
                 fun.aggregate <span class="op">=</span> <span class="va">mean</span>,
                 value.var <span class="op">=</span> <span class="st">"norm"</span>,
                 fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="co"># Negative weights for inhibitory connections</span>
<span class="va">inhib.pns</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/nat/man/subset.html">subset</a></span><span class="op">(</span><span class="va">pn.info</span>, <span class="va">neurotransmitter</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"GABA"</span>,<span class="st">"glutamate"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">cell.type</span><span class="op">)</span>
<span class="va">conn.mat</span><span class="op">[</span><span class="va">inhib.pns</span>,<span class="op">]</span> <span class="op">=</span> <span class="op">-</span><span class="va">conn.mat</span><span class="op">[</span><span class="va">inhib.pns</span>,<span class="op">]</span>

<span class="co"># Max normalisation</span>
<span class="va">normalise</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">conn.mat.scaled</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html">apply</a></span><span class="op">(</span><span class="va">conn.mat</span>,<span class="fl">1</span>,<span class="va">normalise</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Now we can plot a heatmaps of the ALPN-&gt;TON weights, and correlation heatmaps.</p>
<p>First let us get some clusterings for ALPNs and TONs based on their cross-correlation.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># TON correlation matrix</span>
<span class="va">cor.mat</span> <span class="op">=</span> <span class="fu">lsa</span><span class="fu">::</span><span class="fu">cosine</span><span class="op">(</span><span class="va">conn.mat.scaled</span><span class="op">)</span>

<span class="co"># ALPN correlation matrix</span>
<span class="va">cor.mat.2</span> <span class="op">=</span> <span class="fu">lsa</span><span class="fu">::</span><span class="fu">cosine</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">conn.mat.scaled</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Grey tone for heatmap</span>
<span class="va">heatmap.cols</span> <span class="op">=</span> <span class="fu">circlize</span><span class="fu">::</span><span class="fu">colorRamp2</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="op">-</span><span class="fl">0.25</span>, <span class="fl">0</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">1</span><span class="op">)</span>,
                     <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
                       <span class="va">hemibrain_bright_colors</span><span class="op">[[</span><span class="st">"navy"</span><span class="op">]</span><span class="op">]</span>,
                       <span class="va">hemibrain_bright_colors</span><span class="op">[[</span><span class="st">"blue"</span><span class="op">]</span><span class="op">]</span>,
                       <span class="va">hemibrain_bright_colors</span><span class="op">[[</span><span class="st">"cyan"</span><span class="op">]</span><span class="op">]</span>,
                       <span class="st">"grey90"</span>, 
                       <span class="va">hemibrain_bright_colors</span><span class="op">[[</span><span class="st">"yellow"</span><span class="op">]</span><span class="op">]</span>, 
                       <span class="va">hemibrain_bright_colors</span><span class="op">[[</span><span class="st">"orange"</span><span class="op">]</span><span class="op">]</span>,
                       <span class="va">hemibrain_bright_colors</span><span class="op">[[</span><span class="st">"cerise"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="op">)</span>


<span class="co"># dendrogram colours</span>
<span class="va">apricot</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/colorRamp.html">colorRampPalette</a></span><span class="op">(</span><span class="fu">LaCroixColoR</span><span class="fu">::</span><span class="fu">lacroix_palette</span><span class="op">(</span><span class="st">"Apricot"</span><span class="op">)</span><span class="op">)</span>

<span class="co"># clustering</span>
<span class="va">cclus</span> <span class="op">=</span>  <span class="fu">dendroextras</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dendroextras/man/colour_clusters.html">color_clusters</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html">as.dist</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">cor.mat</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"ward.D2"</span><span class="op">)</span>, h <span class="op">=</span> <span class="fl">0.1</span>, col <span class="op">=</span> <span class="va">apricot</span><span class="op">)</span>
<span class="va">rclus</span> <span class="op">=</span>  <span class="fu">dendroextras</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dendroextras/man/colour_clusters.html">color_clusters</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/hclust.html">hclust</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/dist.html">as.dist</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">cor.mat.2</span><span class="op">)</span>, method <span class="op">=</span> <span class="st">"ward.D2"</span><span class="op">)</span>, h <span class="op">=</span> <span class="fl">0.1</span>, col <span class="op">=</span> <span class="va">apricot</span><span class="op">)</span></code></pre></div>
<p>Plot dendrograms:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Plot ALPN clustering</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">rclus</span><span class="op">)</span>

<span class="co"># Plot TON clustering</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">cclus</span><span class="op">)</span></code></pre></div>
<p>We can see what our data like quickly, by plotting some simple heatmaps:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Normalised matrix</span>
<span class="fu">heatmap.2</span><span class="op">(</span>x <span class="op">=</span> <span class="va">conn.mat.scaled</span>, Rowv <span class="op">=</span> <span class="va">rclus</span>, Colv<span class="op">=</span> <span class="va">cclus</span>,
          trace<span class="op">=</span><span class="st">"none"</span>, na.color <span class="op">=</span> <span class="st">"darkgrey"</span>, scale<span class="op">=</span><span class="st">"none"</span>, 
          density.info <span class="op">=</span> <span class="st">"none"</span>, key <span class="op">=</span> <span class="cn">TRUE</span>, symkey<span class="op">=</span><span class="cn">FALSE</span>,
          srtCol<span class="op">=</span><span class="fl">0</span>, srtRow  <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="co"># Correlation matrix for TONs</span>
<span class="fu">heatmap.2</span><span class="op">(</span>x <span class="op">=</span> <span class="va">cor.mat</span>, Rowv <span class="op">=</span> <span class="va">cclus</span>, Colv<span class="op">=</span> <span class="va">cclus</span>,
          trace<span class="op">=</span><span class="st">"none"</span>, na.color <span class="op">=</span> <span class="st">"darkgrey"</span>, scale<span class="op">=</span><span class="st">"none"</span>, 
          density.info <span class="op">=</span> <span class="st">"none"</span>, key <span class="op">=</span> <span class="cn">TRUE</span>, symkey<span class="op">=</span><span class="cn">FALSE</span>,
          srtCol<span class="op">=</span><span class="fl">0</span>, srtRow  <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="co"># Correlation matrix for ALPNs</span>
<span class="fu">heatmap.2</span><span class="op">(</span>x <span class="op">=</span> <span class="va">cor.mat.2</span>, Rowv <span class="op">=</span> <span class="va">rclus</span>, Colv<span class="op">=</span> <span class="va">rclus</span>,
          trace<span class="op">=</span><span class="st">"none"</span>, na.color <span class="op">=</span> <span class="st">"darkgrey"</span>, scale<span class="op">=</span><span class="st">"none"</span>, 
          density.info <span class="op">=</span> <span class="st">"none"</span>, key <span class="op">=</span> <span class="cn">TRUE</span>, symkey<span class="op">=</span><span class="cn">FALSE</span>,
          srtCol<span class="op">=</span><span class="fl">0</span>, srtRow  <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></code></pre></div>
<p>And now we can fully annotate our data with a more complex heatmap:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># columns annotations</span>
<span class="va">ton.compartment</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"axon"</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">conn.mat.scaled</span><span class="op">)</span><span class="op">)</span>,<span class="st">"axon"</span>,<span class="st">"dendrite"</span><span class="op">)</span>
<span class="va">cts</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">"_axon$|_dendrite$"</span>,<span class="st">""</span>,<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">conn.mat.scaled</span><span class="op">)</span><span class="op">)</span>
<span class="va">ton.layers</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"layer_"</span>,<span class="va">ton.info</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">cts</span>,<span class="va">ton.info</span><span class="op">$</span><span class="va">cell.type</span><span class="op">)</span>,<span class="st">"ct.layer"</span><span class="op">]</span><span class="op">)</span>
<span class="va">ton.layers</span><span class="op">[</span><span class="va">ton.layers</span><span class="op">==</span><span class="st">"layer_NA"</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span>
<span class="va">ton.transmitter</span> <span class="op">=</span> <span class="va">ton.info</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">cts</span>,<span class="va">ton.info</span><span class="op">$</span><span class="va">cell.type</span><span class="op">)</span>,<span class="st">"putative.classic.transmitter"</span><span class="op">]</span>
<span class="va">ton.transmitter</span><span class="op">[</span><span class="va">ton.transmitter</span><span class="op">==</span><span class="st">"unknown"</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span>
<span class="va">ton.transmitter</span><span class="op">[</span><span class="va">ton.transmitter</span><span class="op">==</span><span class="st">"acetlcholine"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"acetylcholine"</span>
<span class="va">ton.class</span> <span class="op">=</span> <span class="va">ton.info</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">cts</span>,<span class="va">ton.info</span><span class="op">$</span><span class="va">cell.type</span><span class="op">)</span>,<span class="st">"class"</span><span class="op">]</span>
<span class="va">ton.class</span><span class="op">[</span><span class="va">ton.class</span><span class="op">==</span><span class="st">"LHN"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"LHON"</span>
<span class="va">ha</span> <span class="op">=</span> <span class="fu">HeatmapAnnotation</span><span class="op">(</span>
  df <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>class <span class="op">=</span> <span class="va">ton.class</span>,
                  layer <span class="op">=</span> <span class="va">ton.layers</span>,
                  transmitter <span class="op">=</span> <span class="va">ton.transmitter</span>,
                  compartment <span class="op">=</span> <span class="va">ton.compartment</span><span class="op">)</span>,
   annotation_height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">4</span>, <span class="st">"mm"</span><span class="op">)</span>,
  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>class <span class="op">=</span> <span class="va">paper_colours</span>, layer <span class="op">=</span> <span class="va">paper_colours</span>, transmitter <span class="op">=</span> <span class="va">paper_colours</span>, compartment <span class="op">=</span> <span class="va">paper_colours</span><span class="op">)</span>,
  na_col <span class="op">=</span> <span class="st">"white"</span>
<span class="op">)</span>

<span class="co"># Row annotations</span>
<span class="va">pn.class</span> <span class="op">=</span> <span class="va">pn.info</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">conn.mat.scaled</span><span class="op">)</span>,<span class="va">pn.info</span><span class="op">$</span><span class="va">cell.type</span><span class="op">)</span>,<span class="st">"class"</span><span class="op">]</span>
<span class="va">pn.class</span><span class="op">[</span><span class="va">pn.class</span><span class="op">==</span><span class="st">"biPN"</span><span class="op">]</span> <span class="op">=</span> <span class="st">"mPN"</span>
<span class="va">pn.neurotransmitter</span> <span class="op">=</span> <span class="va">pn.info</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">conn.mat.scaled</span><span class="op">)</span>,<span class="va">pn.info</span><span class="op">$</span><span class="va">cell.type</span><span class="op">)</span>,<span class="st">"neurotransmitter"</span><span class="op">]</span>
<span class="va">pn.ct.layer</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">pn.info</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">conn.mat.scaled</span><span class="op">)</span>,<span class="va">pn.info</span><span class="op">$</span><span class="va">cell.type</span><span class="op">)</span>,<span class="st">"ct.layer"</span><span class="op">]</span><span class="op">)</span>
<span class="va">pn.os</span> <span class="op">=</span> <span class="va">pn.info</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">conn.mat.scaled</span><span class="op">)</span>,<span class="va">pn.info</span><span class="op">$</span><span class="va">cell.type</span><span class="op">)</span>,<span class="st">"odour.scenes"</span><span class="op">]</span>
<span class="va">pn.os</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span><span class="op">(</span><span class="va">pn.os</span>,<span class="st">"/"</span><span class="op">)</span>
<span class="va">pn.os</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">pn.os</span>, <span class="va">sort</span><span class="op">)</span>
<span class="va">pn.os.1</span>  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">pn.os</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">hemibrainr</span><span class="fu">:::</span><span class="fu">nullToNA</span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">pn.os.2</span>  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">pn.os</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">hemibrainr</span><span class="fu">:::</span><span class="fu">nullToNA</span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">pn.os.3</span>  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">pn.os</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">hemibrainr</span><span class="fu">:::</span><span class="fu">nullToNA</span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="va">ha2</span> <span class="op">=</span> <span class="fu">HeatmapAnnotation</span><span class="op">(</span>
  df <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>class <span class="op">=</span> <span class="va">pn.class</span>,
                  layer <span class="op">=</span> <span class="va">pn.ct.layer</span>,
                  transmitter <span class="op">=</span> <span class="va">pn.neurotransmitter</span>,
                  modality.1 <span class="op">=</span> <span class="va">pn.os.1</span>,
                  modality.2 <span class="op">=</span> <span class="va">pn.os.2</span>,
                  modality.3 <span class="op">=</span> <span class="va">pn.os.3</span><span class="op">)</span>,
   annotation_height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">4</span>, <span class="st">"mm"</span><span class="op">)</span>,
  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>class <span class="op">=</span> <span class="va">paper_colours</span>, 
             layer <span class="op">=</span> <span class="va">paper_colours</span>, 
             transmitter <span class="op">=</span> <span class="va">paper_colours</span>, 
             modality.1 <span class="op">=</span> <span class="va">paper_colours</span>,
             modality.2 <span class="op">=</span> <span class="va">paper_colours</span>,
             modality.3 <span class="op">=</span> <span class="va">paper_colours</span><span class="op">)</span>,
  na_col <span class="op">=</span> <span class="st">"white"</span>
<span class="op">)</span>

<span class="co"># Plot complex heatmap!</span>
<span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span><span class="op">(</span><span class="st">"ALPN_TOON_normalised_connectivity.pdf"</span>, height <span class="op">=</span> <span class="fl">14</span>, width <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="fu">Heatmap</span><span class="op">(</span><span class="va">conn.mat.scaled</span>, 
        split <span class="op">=</span> <span class="fl">10</span>, 
        name <span class="op">=</span> <span class="st">" "</span>,
        cluster_rows <span class="op">=</span> <span class="va">rclus</span>,
        cluster_columns <span class="op">=</span> <span class="va">cclus</span>,
        top_annotation <span class="op">=</span> <span class="va">ha</span>,
        show_row_names <span class="op">=</span> <span class="cn">FALSE</span>, 
        show_column_names <span class="op">=</span> <span class="cn">FALSE</span>, 
        col <span class="op">=</span> <span class="va">heatmap.cols</span>,
        heatmap_legend_param <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>by_row <span class="op">=</span> <span class="cn">TRUE</span>, ncol <span class="op">=</span> <span class="fl">1</span>, legend_direction <span class="op">=</span> <span class="st">"vertical"</span>, grid_width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">2</span>, <span class="st">"mm"</span><span class="op">)</span><span class="op">)</span>,
        row_title_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">14</span>, fontfamily  <span class="op">=</span><span class="st">"Helvetica"</span><span class="op">)</span>,
        column_title_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">14</span>, fontfamily  <span class="op">=</span><span class="st">"Helvetica"</span><span class="op">)</span>,
        row_names_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">12</span>, fontfamily  <span class="op">=</span><span class="st">"Helvetica"</span><span class="op">)</span>,
        column_names_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">12</span>, fontfamily  <span class="op">=</span><span class="st">"Helvetica"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
<span class="fu">Heatmap</span><span class="op">(</span><span class="va">pn.class</span>, name <span class="op">=</span> <span class="st">"class"</span>, width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">5</span>, <span class="st">"mm"</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">paper_colours</span>, na_col <span class="op">=</span> <span class="st">"white"</span>,
        row_title_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">14</span>, fontfamily  <span class="op">=</span><span class="st">"Helvetica"</span><span class="op">)</span>,
        column_title_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">14</span>, fontfamily  <span class="op">=</span><span class="st">"Helvetica"</span><span class="op">)</span>,
        column_names_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">12</span>, fontfamily  <span class="op">=</span><span class="st">"Helvetica"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
<span class="fu">Heatmap</span><span class="op">(</span><span class="va">pn.ct.layer</span>, name <span class="op">=</span> <span class="st">"layer"</span>, width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">5</span>, <span class="st">"mm"</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">paper_colours</span>, na_col <span class="op">=</span> <span class="st">"white"</span>,
        row_title_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">14</span>, fontfamily  <span class="op">=</span><span class="st">"Helvetica"</span><span class="op">)</span>,
        column_title_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">14</span>, fontfamily  <span class="op">=</span><span class="st">"Helvetica"</span><span class="op">)</span>,
        column_names_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">12</span>, fontfamily  <span class="op">=</span><span class="st">"Helvetica"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
<span class="fu">Heatmap</span><span class="op">(</span><span class="va">pn.os.1</span>, name <span class="op">=</span> <span class="st">"modality.1"</span>, width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">5</span>, <span class="st">"mm"</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">paper_colours</span>, show_row_names <span class="op">=</span> <span class="cn">FALSE</span>, na_col <span class="op">=</span> <span class="st">"white"</span>,
        row_title_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">14</span>, fontfamily  <span class="op">=</span><span class="st">"Helvetica"</span><span class="op">)</span>,
        column_title_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">14</span>, fontfamily  <span class="op">=</span><span class="st">"Helvetica"</span><span class="op">)</span>,
        column_names_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">12</span>, fontfamily  <span class="op">=</span><span class="st">"Helvetica"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
<span class="fu">Heatmap</span><span class="op">(</span><span class="va">pn.os.2</span>, name <span class="op">=</span> <span class="st">"modality.2"</span>, width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">5</span>, <span class="st">"mm"</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">paper_colours</span>, show_row_names <span class="op">=</span> <span class="cn">FALSE</span>, na_col <span class="op">=</span> <span class="st">"white"</span>,
        row_title_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">14</span>, fontfamily  <span class="op">=</span><span class="st">"Helvetica"</span><span class="op">)</span>,
        column_title_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">14</span>, fontfamily  <span class="op">=</span><span class="st">"Helvetica"</span><span class="op">)</span>,
        column_names_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">12</span>, fontfamily  <span class="op">=</span><span class="st">"Helvetica"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
<span class="fu">Heatmap</span><span class="op">(</span><span class="va">pn.os.3</span>, name <span class="op">=</span> <span class="st">"modality.3"</span>, width <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html">unit</a></span><span class="op">(</span><span class="fl">5</span>, <span class="st">"mm"</span><span class="op">)</span>, col <span class="op">=</span> <span class="va">paper_colours</span>, show_row_names <span class="op">=</span> <span class="cn">FALSE</span>, na_col <span class="op">=</span> <span class="st">"white"</span>,
        row_title_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">14</span>, fontfamily  <span class="op">=</span><span class="st">"Helvetica"</span><span class="op">)</span>,
        column_title_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">14</span>, fontfamily  <span class="op">=</span><span class="st">"Helvetica"</span><span class="op">)</span>,
        column_names_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">12</span>, fontfamily  <span class="op">=</span><span class="st">"Helvetica"</span><span class="op">)</span><span class="op">)</span> 
<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/natverse/hemibrainr/master/inst/images/alpn_toon_heatmap.png" alt="alpn_toon_heatmap.png">
</center>
<p>We can also plot the correlation heatmaps.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Plot for TONs</span>
<span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span><span class="op">(</span><span class="st">"ALPN_to_TOON_crosscorrelation_TOONs.pdf"</span>, height <span class="op">=</span> <span class="fl">7</span>, width <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="fu">Heatmap</span><span class="op">(</span><span class="va">cor.mat</span>, 
        name <span class="op">=</span> <span class="st">"ALPNs' targets' cosine similarity"</span>, 
        split <span class="op">=</span> <span class="cn">NULL</span>, 
        cluster_rows <span class="op">=</span> <span class="va">cclus</span>,
        cluster_columns <span class="op">=</span> <span class="va">cclus</span>,
        bottom_annotation <span class="op">=</span> <span class="va">ha</span>,
        show_row_names <span class="op">=</span> <span class="cn">FALSE</span>, 
        show_column_names <span class="op">=</span> <span class="cn">FALSE</span>, 
        col <span class="op">=</span> <span class="va">heatmap.cols</span>,
        row_title_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">14</span>, fontfamily  <span class="op">=</span><span class="st">"Helvetica"</span><span class="op">)</span>,
        column_title_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">14</span>, fontfamily  <span class="op">=</span><span class="st">"Helvetica"</span><span class="op">)</span>,
        row_names_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">12</span>, fontfamily  <span class="op">=</span><span class="st">"Helvetica"</span><span class="op">)</span>,
        column_names_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">12</span>, fontfamily  <span class="op">=</span><span class="st">"Helvetica"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Plot for ALPNs</span>
<span class="fu"><a href="https://rdrr.io/r/grDevices/pdf.html">pdf</a></span><span class="op">(</span><span class="st">"ALPN_to_TOON_crosscorrelation_ALPNs.pdf"</span>, height <span class="op">=</span> <span class="fl">7</span>, width <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="fu">Heatmap</span><span class="op">(</span><span class="va">cor.mat.2</span>, 
        name <span class="op">=</span> <span class="st">"ALPNs' cosine similarity"</span>, 
        split <span class="op">=</span> <span class="cn">NULL</span>, 
        cluster_rows <span class="op">=</span> <span class="va">rclus</span>,
        cluster_columns <span class="op">=</span> <span class="va">rclus</span>,
        bottom_annotation <span class="op">=</span> <span class="va">ha2</span>,
        show_row_names <span class="op">=</span> <span class="cn">FALSE</span>, 
        show_column_names <span class="op">=</span> <span class="cn">FALSE</span>, 
        col <span class="op">=</span> <span class="va">heatmap.cols</span>,
        row_title_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">14</span>, fontfamily  <span class="op">=</span><span class="st">"Helvetica"</span><span class="op">)</span>,
        column_title_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">14</span>, fontfamily  <span class="op">=</span><span class="st">"Helvetica"</span><span class="op">)</span>,
        row_names_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">12</span>, fontfamily  <span class="op">=</span><span class="st">"Helvetica"</span><span class="op">)</span>,
        column_names_gp <span class="op">=</span> <span class="fu">gpar</span><span class="op">(</span>fontsize <span class="op">=</span> <span class="fl">12</span>, fontfamily  <span class="op">=</span><span class="st">"Helvetica"</span><span class="op">)</span>
<span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/natverse/hemibrainr/master/inst/images/alpn_cosine.png" alt="alpn_cosine.png">
</center>
<center>
<img src="https://raw.githubusercontent.com/natverse/hemibrainr/master/inst/images/toon_cosine.png" alt="toon_cosine.png">
</center>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Alexander Bates, Gregory Jefferis.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
