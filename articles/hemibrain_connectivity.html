<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>hemibrain connectivity • hemibrainr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="hemibrain connectivity">
<meta property="og:description" content="hemibrainr">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hemibrainr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/flywire.html">flywire</a>
    </li>
    <li>
      <a href="../articles/google_filestream.html">read data from Google drive</a>
    </li>
    <li>
      <a href="../articles/hemibrain_axons_dendrites.html">axons and dendrites</a>
    </li>
    <li>
      <a href="../articles/hemibrain_connectivity.html">hemibrain connectivity</a>
    </li>
    <li>
      <a href="../articles/match_making.html">neuron match making</a>
    </li>
    <li>
      <a href="../articles/packages_guide.html">related packags</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/flyconnectome/hemibrainr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>hemibrain connectivity</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/flyconnectome/hemibrainr/blob/master/vignettes/hemibrain_connectivity.Rmd"><code>vignettes/hemibrain_connectivity.Rmd</code></a></small>
      <div class="hidden name"><code>hemibrain_connectivity.Rmd</code></div>

    </div>

    
    
<blockquote>
<p>“We’re Building Something, Here, Detective, We’re Building It From Scratch. All The Pieces Matter.” (<a href="https://en.wikipedia.org/wiki/The_Wire">Lester, The Wire</a>)</p>
</blockquote>
<div id="connection-data" class="section level1">
<h1 class="hasAnchor">
<a href="#connection-data" class="anchor"></a>Connection data</h1>
<p>In this guide, we will use <code>hemibrainr</code> look at connectivity data for a starting neuron of interest. They neuron will be <em>LHMB1</em> <a href="https://www.sciencedirect.com/science/article/pii/S0960982220308587">(Bates &amp; Schlegel et al., 2020)</a>), the only neuron from the ‘innate olfactory’ brain center of the fly (lateral horn), to innervate the ‘associative memroy centre’ directly (mushroom body lobes). You can try re-running this analysis for any neuron of your interest.</p>
<p>We will use precomputed data from the <code>hemibrainr</code> Google team drive. In order to connect R to this Google drive, you have a few options. Please see <a href="https://flyconnectome.github.io/hemibrainr/articles/google_filestream.html">this article</a>. To see how to split neurons into axon and dendrite, without acces to this drive, please see <a href="https://flyconnectome.github.io/hemibrainr/articles/hemibrain_axons_dendrites.html">this article</a>.</p>
<div id="load-google-drive" class="section level2">
<h2 class="hasAnchor">
<a href="#load-google-drive" class="anchor"></a>Load google drive</h2>
<p>Let’s get hemibrainr and our Google drive loaded:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load package</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/flyconnectome/hemibrainr">hemibrainr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>

<span class="co"># Else, it wants to see it on the mounted team drive, here</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span><span class="st">"Gdrive_hemibrain_data"</span><span class="op">)</span>

<span class="co"># If this does not give a path to the hemibrainr google drive...</span>
<span class="co">## But you do have access, and have set up rclone</span>
<span class="co">### Try:</span>
<span class="co">##### hemibrainr_rclone()</span></code></pre></div>
</div>
<div id="find-neuron-of-interest" class="section level2">
<h2 class="hasAnchor">
<a href="#find-neuron-of-interest" class="anchor"></a>Find neuron of interest</h2>
<p>First, let us find the beautiful LHMB1 neuron:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lhmb1.meta</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nat/man/subset.html">subset</a></span><span class="op">(</span><span class="va">hemibrain_metrics</span>, <span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"LHMB1"</span>, <span class="va">name</span><span class="op">)</span><span class="op">)</span>
<span class="va">lhmb1.bodyid</span> <span class="op">=</span> <span class="va">lhmb1.meta</span><span class="op">$</span><span class="va">bodyid</span></code></pre></div>
<p>We now have our unique identifier, ‘body ID’, for LHMB1. We can use it to get hold of this neuron:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">db</span> <span class="op">=</span> <span class="fu"><a href="../reference/hemibrain_read_neurons.html">hemibrain_neurons</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># This a neuronlistfh object read from the google drive</span>
<span class="va">lhmb1.neuron</span> <span class="op">=</span> <span class="va">db</span><span class="op">[</span><span class="va">lhmb1.bodyid</span><span class="op">]</span>

<span class="co"># Alternatively, without the drive:</span>
<span class="co">## lhmb1.neuron = hemibrain_read_neurons(lhmb1.bodyid, remote = FALSE)</span></code></pre></div>
<p>Let us confirm it is what we think it is, by plotting this neurons:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get ROIs</span>
<span class="va">lhr</span> <span class="op">=</span> <span class="fu">neuprint_ROI_mesh</span><span class="op">(</span><span class="st">"LH(R)"</span><span class="op">)</span>
<span class="va">mbr</span> <span class="op">=</span> <span class="fu">neuprint_ROI_mesh</span><span class="op">(</span><span class="st">"MB(R)"</span><span class="op">)</span>

<span class="co"># Plot</span>
<span class="fu">nat</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nat/man/nopen3d.html">nopen3d</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="../reference/hemibrain_view.html">hemibrain_view</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/nat/man/plot3d.html">plot3d</a></span><span class="op">(</span><span class="va">lhr</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, col <span class="op">=</span> <span class="va">hemibrain_bright_colors</span><span class="op">[</span><span class="st">"green"</span><span class="op">]</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/nat/man/plot3d.html">plot3d</a></span><span class="op">(</span><span class="va">mbr</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, col <span class="op">=</span> <span class="va">hemibrain_bright_colors</span><span class="op">[</span><span class="st">"pink"</span><span class="op">]</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/nat/man/plot3d.html">plot3d</a></span><span class="op">(</span><span class="va">hemibrain.surf</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>, col <span class="op">=</span> <span class="st">"lightgrey"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="fu"><a href="../reference/plot3d_split.html">plot3d_split</a></span><span class="op">(</span><span class="va">lhmb1.neuron</span>, lwd <span class="op">=</span><span class="fl">2</span>, soma <span class="op">=</span> <span class="fl">600</span><span class="op">)</span></code></pre></div>
<center>
<img src="https://raw.githubusercontent.com/flyconnectome/hemibrainr/master/inst/images/birthday.png" alt="birthday">
</center>
<p>So here you can see dendrite (blue) in the lateral horn (green volume) and calyx, and axon (orange) in the lobes of the msuhroom body (pink volume).</p>
</div>
<div id="get-neuron-connectivity-data" class="section level2">
<h2 class="hasAnchor">
<a href="#get-neuron-connectivity-data" class="anchor"></a>Get neuron connectivity data</h2>
<p>Now we can get a precomputed edgelist for the brain from the Google drive, which breaks down connections by axon and dendrite. By default this is read from an SQLlite database on the Google drive. This means we can access the data, without loading a multi Gb .csv into memory:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get  the edgelist</span>
<span class="va">elist</span> <span class="op">=</span> <span class="fu"><a href="../reference/hemibrainr_googledrive_data.html">hemibrain_elist</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Let's count a strong connection as one that is 10-synapses strong and/or account for at least 1% of the downstream arbour's postsynapses:</span>
<span class="va">elist.strong</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nat/man/subset.html">subset</a></span><span class="op">(</span><span class="va">elist</span>, <span class="va">elist</span><span class="op">$</span><span class="va">count</span> <span class="op">&gt;=</span> <span class="fl">10</span> <span class="op">|</span> <span class="va">elist</span><span class="op">$</span><span class="va">norm</span> <span class="op">&gt;=</span> <span class="fl">0.01</span><span class="op">)</span>

<span class="co"># Get a lot of meyta data for each hemibrain neuron</span>
<span class="va">hemi.meta</span> <span class="op">=</span> <span class="fu"><a href="../reference/hemibrainr_googledrive_data.html">hemibrain_meta</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>In our <code>elist</code>, count is the number of synaptic connections between two arbours. The arbour types are given by <code>Label</code> and <code>partner.Label</code>. The neuron identities are given as <code>pre</code>, the upstream (source) neuron and <code>post</code>, the downstream (target) neuron. The value of <code>norm</code> is generated by taking <code>count</code> and dividing it by the total number of posynapses on the downstream target’s given arbour (note, not all connection in the neuron!). See your <a href="https://flyconnectome.github.io/hemibrainr/articles/hemibrain_axons_dendrites.html">article</a> on neuron splitting, for more information.</p>
<p>We have the connectivity of whe whole dataset at our fingertips. Or at least, all the large fragments that could be considered neurons (see <code>?hemibrain_bodyids</code>). Let us have a quick look at what rthe distribution of different connection types is:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lhmb1.elist</span> <span class="op">&lt;-</span> <span class="va">elist</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">pre</span> <span class="op">==</span> <span class="va">lhmb1.bodyid</span> <span class="op">|</span> <span class="va">post</span> <span class="op">==</span> <span class="va">lhmb1.bodyid</span>, <span class="va">count</span> <span class="op">&gt;</span> <span class="fl">10</span> <span class="op">|</span> <span class="va">norm</span> <span class="op">&gt;</span> <span class="fl">0.01</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>feedback <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span> <span class="op">(</span><span class="va">post</span> <span class="op">%in%</span> <span class="va">.data</span><span class="op">$</span><span class="va">pre</span> <span class="op">&amp;</span> <span class="va">post</span> <span class="op">%in%</span> <span class="va">.data</span><span class="op">$</span><span class="va">post</span><span class="op">)</span><span class="op">)</span> <span class="op">&amp;</span> <span class="op">!</span><span class="va">post</span><span class="op">%in%</span><span class="va">lhmb1.bodyid</span> <span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">norm</span><span class="op">)</span>, <span class="fu">desc</span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># sort</span>
  <span class="fu">mutate</span><span class="op">(</span>post.type <span class="op">=</span> <span class="va">hemi.meta</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">post</span>, <span class="va">hemi.meta</span><span class="op">$</span><span class="va">bodyid</span><span class="op">)</span>,<span class="st">"type"</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># cell type</span>
  <span class="fu">mutate</span><span class="op">(</span>post.layer <span class="op">=</span> <span class="va">hemi.meta</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">post</span>, <span class="va">hemi.meta</span><span class="op">$</span><span class="va">bodyid</span><span class="op">)</span>,<span class="st">"ct.layer"</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># 'layre' in the olfactory system</span>
  <span class="fu">mutate</span><span class="op">(</span>pre.type <span class="op">=</span> <span class="va">hemi.meta</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">pre</span>, <span class="va">hemi.meta</span><span class="op">$</span><span class="va">bodyid</span><span class="op">)</span>,<span class="st">"type"</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">mutate</span><span class="op">(</span>pre.layer <span class="op">=</span> <span class="va">hemi.meta</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/match.html">match</a></span><span class="op">(</span><span class="va">pre</span>, <span class="va">hemi.meta</span><span class="op">$</span><span class="va">bodyid</span><span class="op">)</span>,<span class="st">"ct.layer"</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/nat/man/neuronlist-dataframe-methods.html">head</a></span><span class="op">(</span><span class="va">lhmb1.elist</span><span class="op">)</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Alexander Bates, Gregory Jefferis.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
