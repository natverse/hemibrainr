<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>neuron match making • hemibrainr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="neuron match making">
<meta property="og:description" content="hemibrainr">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hemibrainr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/flywire.html">flywire</a>
    </li>
    <li>
      <a href="../articles/glomerulus_search.html">glomerulus search</a>
    </li>
    <li>
      <a href="../articles/google_filestream.html">read data from Google drive</a>
    </li>
    <li>
      <a href="../articles/hemibrain_alpns_toons.html">olfactory connectivity</a>
    </li>
    <li>
      <a href="../articles/hemibrain_axons_dendrites.html">axons and dendrites</a>
    </li>
    <li>
      <a href="../articles/hemibrain_connectivity.html">hemibrain connectivity</a>
    </li>
    <li>
      <a href="../articles/match_making.html">neuron match making</a>
    </li>
    <li>
      <a href="../articles/meta_data.html">hemibrain and flywire meta data</a>
    </li>
    <li>
      <a href="../articles/packages_guide.html">related packages</a>
    </li>
    <li>
      <a href="../articles/transmitters.html">transmitters</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/flyconnectome/hemibrainr/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="match_making_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>neuron match making</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/flyconnectome/hemibrainr/blob/master/vignettes/match_making.Rmd"><code>vignettes/match_making.Rmd</code></a></small>
      <div class="hidden name"><code>match_making.Rmd</code></div>

    </div>

    
    
<blockquote>
<p>“Oh, but nonsense, she thought; William must marry Lily. They have so many things in common. Lily is so fond of flowers. They are both cold and aloof and rather self-sufficing. She must arrange for them to take a long walk together.” (<a href="https://en.wikipedia.org/wiki/To_the_Lighthouse">Virginia Woolf, To The Lighthouse</a>)</p>
</blockquote>
<div id="neuron-matching-making" class="section level1">
<h1 class="hasAnchor">
<a href="#neuron-matching-making" class="anchor"></a>Neuron Matching Making</h1>
<p>Insect brains seem pretty stereotyped. But just how stereotyped are they? It comes as a surprise to many neuroscientists who work only on vertebrates, to learn that in insects, individual neurons can readily and reliably be re-found and identified across different members of the species. Perhaps even across species.</p>
<center>
<img src="https://raw.githubusercontent.com/natverse/hemibrainr/master/inst/images/slick_matches.png" title="fig:" alt="match_examples">
</center>
<p>As of 2020, two large data sets for the vinegar fly, D. melanogaster, are available making it possible to look at the full morphology of ~25,000 neurons in two data sets. These data sets are the <a href="https://neuprint.janelia.org/help/videos?dataset=hemibrain%3Av1.0&amp;qt=findneurons&amp;qr%5B0%5D%5Bcode%5D=fn&amp;qr%5B0%5D%5Bds%5D=hemibrain%3Av1.0&amp;qr%5B0%5D%5Bpm%5D%5Bdataset%5D=hemibrain%3Av1.0&amp;qr%5B0%5D%5Bpm%5D%5Binput_ROIs%5D%5B0%5D=ATL%28R%29&amp;qr%5B0%5D%5Bpm%5D%5Boutput_ROIs%5D%5B0%5D=IB&amp;qr%5B0%5D%5BvisProps%5D%5BrowsPerPage%5D=25&amp;tab=0&amp;q=1">hemibrain</a> and <a href="https://neuropil.janelia.org/tracing/fafb/v14/">FAFB</a>. However, neurons in FAFB have been semi-manually or manually reconstructed, making the automatic assignment of FAFB-hemibrain neuron matches non-trivial. In this R package we have built tools to enable users to record and deploy inter-dataset matches.</p>
<p>What use is this information? Matches could be used to look at morphological stereotypy, help find genetic lines that label neurons, help transfer information associated with on reconstructed to the same cell in a different brain, compare neuron connectivity between two brains, etc.</p>
<p>For example, by matching neurons up between the hemibrain and FAFB, we see that the numbers of <a href="https://pubmed.ncbi.nlm.nih.gov/30703584/">cell_types</a> within one ‘hemilineage’ (a set of neurons that are born and develop together) are comparable between these two different flies:</p>
<center>
<img src="https://raw.githubusercontent.com/natverse/hemibrainr/master/inst/images/hemilineage_example.png" title="fig:" alt="hemilineage_example">
</center>
<p>In order to match neurons, we make use of other <a href="http://natverse.org/">natverse</a> tools to ‘bridge’ data between two different brainspace, so they can be co-visualised (enabled by template brain and bridging registrations by <a href="https://www.biorxiv.org/content/10.1101/376384v2.full">Bogovic et al. 2019</a>):</p>
<center>
<img src="https://raw.githubusercontent.com/natverse/hemibrainr/master/inst/images/hemibrain_to_FAFB.png" title="fig:" alt="hemibrain_to_FAFB">
</center>
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>In general, our interactive matching pipelines follow this workflow (this example is for <code>fafb_matching</code>):</p>
<center>
<img src="https://raw.githubusercontent.com/natverse/hemibrainr/master/inst/images/pipeline1.png" title="fig:" alt="pipeline1">
</center>
<center>
<img src="https://raw.githubusercontent.com/natverse/hemibrainr/master/inst/images/pipeline2.png" title="fig:" alt="pipeline3">
</center>
<center>
<img src="https://raw.githubusercontent.com/natverse/hemibrainr/master/inst/images/pipeline3.png" title="fig:" alt="pipeline3">
</center>
<center>
<img src="https://raw.githubusercontent.com/natverse/hemibrainr/master/inst/images/pipeline4.png" title="fig:" alt="pipeline4">
</center>
<center>
<img src="https://raw.githubusercontent.com/natverse/hemibrainr/master/inst/images/pipeline5.png" title="fig:" alt="pipeline5">
</center>
<center>
<img src="https://raw.githubusercontent.com/natverse/hemibrainr/master/inst/images/pipeline6.png" title="fig:" alt="pipeline6">
</center>
<center>
<img src="https://raw.githubusercontent.com/natverse/hemibrainr/master/inst/images/pipeline7.png" title="fig:" alt="pipeline7">
</center>
</div>
<div id="what-you-need" class="section level2">
<h2 class="hasAnchor">
<a href="#what-you-need" class="anchor"></a>What You need</h2>
<p>In order to use these tools you will need to have <a href="https://rstudio.com/">RStudio</a> and to have installed the <a href="http://natverse.org/">natverse</a>. To use them to maximum effect, you will need to also have permission to access the <a href="https://neuropil.janelia.org/tracing/fafb/v14/">FAFB CATMAID v14 project</a>, although some neurons are available to be read by the public from <a href="https://v2.virtualflybrain.org/org.geppetto.frontend/geppetto">Virtual Fly Brain</a>’s CATMAID project for FAFB and should have the same unique skeleton ID numbers. Our pipeline function makes use of the <a href="https://support.google.com/a/answer/7491144?hl=en">Google Filestream</a> application, which should be installed on your machine. Further, note that neurons are read from the FAFB CATMAID project, and you must have login details for this project recorded in your .Renviron (edit with: <code><a href="https://usethis.r-lib.org/reference/edit.html">usethis::edit_r_environ()</a></code>) for these functions to work. For help, see <a href="https://github.com/natverse/rcatmaid">here</a> and <a href="https://github.com/natverse/neuprintr">here</a>.</p>
<div id="authorisation" class="section level3">
<h3 class="hasAnchor">
<a href="#authorisation" class="anchor"></a>Authorisation</h3>
<p>In order to write neuron matches to the project you must have access to the <code>hemibrain</code> Google Drive or the match making Google sheet (see below) owned by the <a href="https://www.zoo.cam.ac.uk/research/cell-and-developmental-biology/drosophila-connectomics#:~:text=The%20project%20aims%20to%20reconstruct,Research%20Campus%20in%20the%20US.">Drosophila Connectomics Group</a>. If you do not have access but would like to help or use this information, get in contact! You do not need programming skills to to help us match make neurons, as we have written an interactive pipeline in R which does most of the work for you (see below).</p>
<p>We regularly also up-date a data frame saved in this package, as a snapshot of matches that have been made. Without authorisation you can access these matches but they may not be the most up-to-date:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load package</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/flyconnectome/hemibrainr">hemibrainr</a></span><span class="op">)</span>
<span class="co"># See matches</span>
<span class="fu"><a href="https://rdrr.io/r/utils/View.html">View</a></span><span class="op">(</span><span class="va">hemibrain_matched</span><span class="op">)</span></code></pre></div>
</div>
<div id="the-google-sheet" class="section level3">
<h3 class="hasAnchor">
<a href="#the-google-sheet" class="anchor"></a>The Google Sheet</h3>
<p>We in the <a href="https://www.zoo.cam.ac.uk/research/cell-and-developmental-biology/drosophila-connectomics#:~:text=The%20project%20aims%20to%20reconstruct,Research%20Campus%20in%20the%20US.">Drosophila Connectomics Group</a> have been recording our match making in a Google sheet named <a href="https://docs.google.com/spreadsheets/d/1OSlDtnR3B1LiB5cwI5x5Ql6LkZd8JOS5bBr-HTi0pOw/edit">em_matching</a>. This sheet has two tabs of concern here, <code>hemibrain</code> for hemibrain neuron -&gt; FAFB neuron matches and <code>fafb</code> for FAFB neuron to hemibrain neuron matches.</p>
<center>
<img src="https://raw.githubusercontent.com/natverse/hemibrainr/master/inst/images/google_sheet.png" title="fig:" alt="google_sheet">
</center>
<p>If you have authorisation, you can see the most up-to-date matches as so:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">matches</span> <span class="op">=</span> <span class="fu"><a href="../reference/hemibrain_matches.html">hemibrain_matches</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># You will be asked to log-in through a Google-enabled email address.</span>
<span class="fu"><a href="https://rdrr.io/r/utils/View.html">View</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">matches</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>As you can see, other meta information is present in the data frame <code>matches</code>. The function <code>hemibrain_matches</code> has an argument called <code>priority</code>. This specifies whether to use FAFB-&gt;hemibrain_matches (FAFB) or hemibrain-&gt;FAFB matches (hemibrain) in order to ascribe cell_type names to FAFB neurons. In both cases, cell_type names are attached to hemibrain bodyids, and propagated to their FAFB matches.</p>
</div>
</div>
<div id="match-quality" class="section level2">
<h2 class="hasAnchor">
<a href="#match-quality" class="anchor"></a>Match Quality</h2>
<p>Once a match is recorded, the user selects a quality for that match. There can be no match (none), a tract-only match (tract) a poor match (poor) an okay match (medium) or an exact match (good). As a rule of thumb, a poor match could be a neuron from a very similar same cell_type or a highly untraced neuron that may be the correct cell_type. An okay match should be a neuron that looks to be from the same morphological cell_type but there may be some discrepancies in its arbour. A good match is a neuron that corresponds well between FAFB and the hemibrain data. A tract only match just means that the matched neuron should share the same cell body fiber, and therefore same developmental ontogeny, even if the rest of its morphology is quite different.</p>
<p>It is very important to note that a match cannot be a match if neurons do not seem to share the same cell body fiber tract. Being in a different tract is a deal breaker.</p>
<p>Some good matches are striking. For example:</p>
<center>
<img src="https://raw.githubusercontent.com/natverse/hemibrainr/master/inst/images/good_match_1.png" title="fig:" alt="good_match_1">
</center>
<p>In the above case, the FAFB neuron has been quite extensively manually traced, meaning that these cells look very similar to one another.</p>
<p>Be aware that while neurons must share the same cell body fiber tract, these tracts can be a little off set. For example, this is also a good match:</p>
<center>
<img src="https://raw.githubusercontent.com/natverse/hemibrainr/master/inst/images/good_match_2.png" title="fig:" alt="good_match_2">
</center>
<p>If the soma is missing, it might be safer to note a match as ‘medium’.</p>
<center>
<img src="https://raw.githubusercontent.com/natverse/hemibrainr/master/inst/images/medium_match_1.png" title="fig:" alt="medium_match_1">
</center>
<p>You might also use medium if you have a nice looking match and suspect that there is a medium/large discrepancy because the FAFB neuron (here shown in red) is under-traced, such as:</p>
<center>
<img src="https://raw.githubusercontent.com/natverse/hemibrainr/master/inst/images/medium_match_2.png" title="fig:" alt="medium_match_2">
</center>
<p>Or:</p>
<center>
<img src="https://raw.githubusercontent.com/natverse/hemibrainr/master/inst/images/medium_match_3.png" title="fig:" alt="medium_match_3">
</center>
<p>Bear in mind that the hemibrain volume only covers ~1/4 of the fly mid-brain, so neurons are truncated (here hemibrain neuron in black) but we can still make matches for many of them:</p>
<center>
<img src="https://raw.githubusercontent.com/natverse/hemibrainr/master/inst/images/medium_match_4.png" title="fig:" alt="medium_match_4">
</center>
<p>A larger degree of under-tracing may lead you to assign a match as poor. In this case, you think the two neurons may be ‘the same isomorphic cell_type’ but you could be wrong. For example:</p>
<center>
<img src="https://raw.githubusercontent.com/natverse/hemibrainr/master/inst/images/poor_match_1.png" title="fig:" alt="poor_match_1">
</center>
<p>A poor match may also be made if you think there is a slight offset, possibly due to a registration issue:</p>
<center>
<img src="https://raw.githubusercontent.com/natverse/hemibrainr/master/inst/images/poor_match_2.png" title="fig:" alt="poor_match_2">
</center>
<p>Though in this case, choosing an even lesser-traced FAFB neuron may be better:</p>
<center>
<img src="https://raw.githubusercontent.com/natverse/hemibrainr/master/inst/images/poor_match_3.png" title="fig:" alt="poor_match_3">
</center>
<p>A poor match can be given even to very under-traced FAFB neurons:</p>
<center>
<img src="https://raw.githubusercontent.com/natverse/hemibrainr/master/inst/images/poor_match_4.png" title="fig:" alt="poor_match_4">
</center>
<p>And even fragments if you are convinced the morphology is unique enough (but be careful!):</p>
<center>
<img src="https://raw.githubusercontent.com/natverse/hemibrainr/master/inst/images/poor_match_5.png" title="fig:" alt="poor_match_5">
</center>
<div id="adding-your-own-matches" class="section level3">
<h3 class="hasAnchor">
<a href="#adding-your-own-matches" class="anchor"></a>Adding Your Own Matches</h3>
<p>So far we have matched up a few thousand neurons. About 25 thousand matches are possible because that is the number of reconstructed neurons in the hemibrain data set. You can help us (and yourself!) by adding matches to our database. There are two main ways of doing this:</p>
</div>
<div id="adding-ready-made-matches" class="section level3">
<h3 class="hasAnchor">
<a href="#adding-ready-made-matches" class="anchor"></a>Adding Ready-Made Matches</h3>
<p>You can add matches you have already made by your own means. For this, you will need to get a data frame into R (e.g. reading from a <code>.csv</code> file) that has three columns: <code>bodyid</code>, which contains the hemibrain neurons’ unique Body IDs, <code>skid</code> which has the skeleton IDs for FAFB CATMAID neurons, and <code>quality</code> which gives a qualitative assessment of match quality (see above). If in doubt, put poor.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">made.matches</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"my_matches.csv"</span><span class="op">)</span> <span class="co"># Must have the named columns: bodyid, skid, quality</span>
<span class="fu"><a href="../reference/hemibrain_matches.html">hemibrain_matches</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">made.matches</span>, direction <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span> <span class="co"># direction controls which tabs matches get written to</span></code></pre></div>
<p>Sometimes you cannot add a match, as your neuron either does not exist in the first column of the <code>hemibrain</code> tab of our Google sheet or of the <code>fafb</code> sheet. In these cases, if you have a valid ID, you can either add it to the sheet manually, or programmatically so that all the right meta data is easily included:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Add a mising FAFB projection neuron, so we can match it later:</span>
<span class="fu"><a href="../reference/flywire_matching_rewrite.html">hemibrain_matching_add</a></span><span class="op">(</span>ids <span class="op">=</span> <span class="st">"16"</span>, sheet <span class="op">=</span> <span class="st">"fafb"</span>, User <span class="op">=</span> <span class="st">"ASB"</span><span class="op">)</span>
<span class="co">## the sheet argument specifies the worksheet or 'tab' on the Google sheet we want to add to</span></code></pre></div>
</div>
</div>
<div id="the-match-making-pipeline" class="section level2">
<h2 class="hasAnchor">
<a href="#the-match-making-pipeline" class="anchor"></a>The Match Making Pipeline</h2>
<p>You can also use our interactive pipeline to match neurons between hemibrain and FAFB. There are two version of this pipeline. One that takes hemibrain neurons from <a href="https://github.com/natverse/neuprintr">neuPrint</a>, and tries to find the best match for each hemibrain neuron (<code>hemibrain_matching</code>) and one that takes FAFB neurons from <a href="https://github.com/natverse/rcatmaid">CATMAID</a> and tries to find the best hemibrain_match for those FAFB neurons (<code>fafb_matching</code>). There is also a third pipeline (<code>LR_matching</code>) that takes advantage of the fact that the FAFB data set has two intact hemispheres and invites you to match up <a href="https://ngl.flywire.ai/?local_id=c8c06ea181ad5447b04beacfc4cb1b66">FlyWire</a> between the two hemispheres. Once matches are made, the result become available with <code>hemibrain_matches</code>.</p>
<p>The <a href="https://docs.google.com/spreadsheets/d/1OSlDtnR3B1LiB5cwI5x5Ql6LkZd8JOS5bBr-HTi0pOw/edit">Google sheet</a> is set up with limited number of users, each of whom have been assigned a number of neurons to match up. In order to add yourself as a user, simply open this Google Sheet in your browser and add your initials to neurons of your choosing on the rightmost column ‘Users’.</p>
<p>For a video tutorial, see <a href="https://drive.google.com/drive/folders/1MOwfPGCPvY8eVLZoOfXOBhVcS6U996g9">here</a>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># install package to bridge neurons between FAFB14 and hemibrain space</span>
<span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/ns-load.html">requireNamespace</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">'natverse/nat.jrcbrains'</span><span class="op">)</span>
<span class="fu">nat.jrcbrains</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nat.jrcbrains/man/download_saalfeldlab_registrations.html">download_saalfeldlab_registrations</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Match hemibrain neurons!</span>
<span class="fu"><a href="../reference/LR_matching.html">hemibrain_matching</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># Automatically, you can choose a User ID and you are given neurons that have this ID in the User column on the Google Sheet.</span>
<span class="fu"><a href="../reference/LR_matching.html">hemibrain_matching</a></span><span class="op">(</span>ids<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"674108632"</span>,<span class="st">"739256609"</span><span class="op">)</span><span class="op">)</span> <span class="co"># Otherwise you can select specific IDs</span>
<span class="fu"><a href="../reference/LR_matching.html">hemibrain_matching</a></span><span class="op">(</span>ids<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"674108632"</span>,<span class="st">"739256609"</span><span class="op">)</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># If a match has already been made you can overwrite it</span>
<span class="co"># Otherwise neurons that have already been given a match will not be shown in the pipeline.</span>
<span class="fu"><a href="../reference/LR_matching.html">hemibrain_matching</a></span><span class="op">(</span>overwrite <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="co"># We can also set the pipeline to 'overwrite' cases where 'none' and 'tract' are the given match quality, i.e. re-look at cases where a proper match could not be made.</span>

<span class="co"># Match FAFB neurons!</span>
<span class="fu"><a href="../reference/LR_matching.html">fafb_matching</a></span><span class="op">(</span><span class="op">)</span>
<span class="fu"><a href="../reference/LR_matching.html">fafb_matching</a></span><span class="op">(</span>ids <span class="op">=</span> <span class="st">"16"</span><span class="op">)</span> <span class="co"># Specify IDs</span>
<span class="fu"><a href="../reference/LR_matching.html">fafb_matching</a></span><span class="op">(</span>ids <span class="op">=</span> <span class="st">"16"</span>, overwrite <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># Overwrite</span>
<span class="fu"><a href="../reference/LR_matching.html">fafb_matching</a></span><span class="op">(</span>ids <span class="op">=</span> <span class="st">"16"</span>, overwrite <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="co"># Re-look only if no proper match, or just a tract-only match, was found before.</span></code></pre></div>
<p>When you run these functions you will enter an interactive pipeline in an <code>rgl</code> window. Prompts will be given to you in your R console and you can rotate and pan in the window to see neurons. The neuron selected for-matching is shown in blue (i.e. if using <code>hemibrain_matching</code> this will be a hemibrain neuron), and potential matches in red (i.e. if using <code>hemibrain_matching</code> these will be FAFB neurons). Potential matches are shown by <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC4961245/">NBLAST</a> score (a measure of morphological similarity). Usually, for reasonably traced FAFB neurons, a good match appears in the top 10 hits.</p>
<center>
<img src="https://raw.githubusercontent.com/natverse/hemibrainr/master/inst/images/pipeline_console.png" title="fig:" alt="pipeline_console">
</center>
</div>
<div id="re-setting-and-transferring" class="section level2">
<h2 class="hasAnchor">
<a href="#re-setting-and-transferring" class="anchor"></a>Re-setting and transferring</h2>
<p>You can transfer matches between the <code>hemibrain</code> and <code>fafb</code> tabs, as well as refresh these tabs with the most up-to-date meta data using the following code. You will be manipulating the Google sheet for all users, so please use with caution. If in doubt, do not use.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Add all hemibrain neurons to sheet</span>
<span class="fu"><a href="../reference/flywire_matching_rewrite.html">hemibrain_matching_rewrite</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Add all FAFB neurons with lineage annotations to sheet</span>
<span class="fu"><a href="../reference/flywire_matching_rewrite.html">fafb_matching_rewrite</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Transfer matches made in one sheet to the other</span>
<span class="fu"><a href="../reference/flywire_matching_rewrite.html">hemibrain_matching_transfers</a></span><span class="op">(</span><span class="op">)</span>

<span class="co"># Get hemibrain information into v14 CATMAID for matches, as annotations:</span>
<span class="va">matches</span> <span class="op">=</span> <span class="fu"><a href="../reference/hemibrain_matches.html">hemibrain_matches</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">matches</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/nat/man/subset.html">subset</a></span><span class="op">(</span><span class="va">matches</span>, <span class="va">match.quality</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"good"</span>,<span class="st">"medium"</span>,<span class="st">"poor"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">dataset</span> <span class="op">==</span> <span class="st">"FAFB"</span><span class="op">)</span>
<span class="va">skds</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">matches</span><span class="op">)</span>
<span class="fu"><a href="../reference/fafb_hemibrain_annotate.html">fafb_hemibrain_annotate</a></span><span class="op">(</span><span class="va">skds</span><span class="op">)</span></code></pre></div>
</div>
<div id="uses" class="section level2">
<h2 class="hasAnchor">
<a href="#uses" class="anchor"></a>Uses</h2>
<p>One use we have already found for all of this match making, is to cross-identify neuron cell body fiber tracts and <a href="https://pubmed.ncbi.nlm.nih.gov/23541733/">(hemi)lineages</a>. This means that we now have the locations in FAFB for different known sets of cells. You can see seed planes for them <a href="https://docs.google.com/spreadsheets/d/1HI8RZJhV8aWC6hw5T0qh2__9D8V0zKdtxx2kkDsuI8Y/edit?usp=sharing">here</a>.</p>
<center>
<img src="https://raw.githubusercontent.com/natverse/hemibrainr/master/inst/images/google_sheet_lineages.png" title="fig:" alt="google_sheet_lineages">
</center>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Alexander Bates, Gregory Jefferis.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
